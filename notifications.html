<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notifications - UNCAGED</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'DM Sans',sans-serif;background:#0D0D0D;color:#FFF;min-height:100vh}
        .navbar{display:flex;justify-content:space-between;align-items:center;padding:1rem 2rem;background:#1A1A1A;border-bottom:1px solid #2A2A2A;position:sticky;top:0;z-index:100}
        .logo{font-family:'Bebas Neue',sans-serif;font-size:2rem;background:linear-gradient(135deg,#F5A623,#D4880F);-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-decoration:none}
        .nav-links{display:flex;align-items:center;gap:1.5rem}
        .nav-links a{color:#B3B3B3;text-decoration:none;font-weight:500}.nav-links a:hover{color:#F5A623}
        .profile-dropdown{position:relative}
        .profile-btn{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,#F5A623,#D4880F);border:none;cursor:pointer;font-weight:600;color:#0D0D0D}
        .dropdown-menu{position:absolute;top:50px;right:0;background:#1A1A1A;border:1px solid #2A2A2A;border-radius:8px;min-width:200px;display:none;z-index:200}
        .dropdown-menu.show{display:block}
        .dropdown-menu a{display:block;padding:.8rem 1rem;color:#B3B3B3;text-decoration:none}
        .dropdown-menu a:hover{background:#242424;color:#F5A623}
        
        .main-content{max-width:800px;margin:0 auto;padding:2rem}
        .page-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem}
        .page-title{font-family:'Bebas Neue',sans-serif;font-size:2.5rem}
        .mark-all-btn{padding:0.5rem 1rem;background:#242424;border:1px solid #2A2A2A;border-radius:8px;color:#B3B3B3;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all 0.2s}
        .mark-all-btn:hover{border-color:#F5A623;color:#F5A623}
        
        .filters{display:flex;gap:1rem;margin-bottom:2rem}
        .filter-btn{padding:0.5rem 1rem;background:#1A1A1A;border:1px solid #2A2A2A;border-radius:20px;color:#B3B3B3;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all 0.2s}
        .filter-btn:hover,.filter-btn.active{border-color:#F5A623;color:#F5A623}
        
        .notifications-list{display:flex;flex-direction:column;gap:0.5rem}
        .notification-item{display:flex;align-items:flex-start;gap:1rem;padding:1rem;background:#1A1A1A;border-radius:12px;border:1px solid #2A2A2A;cursor:pointer;transition:all 0.2s}
        .notification-item:hover{border-color:#333}
        .notification-item.unread{background:#1F1A14;border-color:#3D3428}
        .notification-item.unread::before{content:'';width:8px;height:8px;background:#F5A623;border-radius:50%;flex-shrink:0;margin-top:0.5rem}
        .notification-icon{width:48px;height:48px;border-radius:50%;background:#242424;display:flex;align-items:center;justify-content:center;font-size:1.5rem;flex-shrink:0}
        .notification-icon.like{background:rgba(244,67,54,0.2)}
        .notification-icon.comment{background:rgba(33,150,243,0.2)}
        .notification-icon.subscriber{background:rgba(245,166,35,0.2)}
        .notification-content{flex:1;min-width:0}
        .notification-text{margin-bottom:0.25rem;line-height:1.4}
        .notification-text strong{color:#F5A623}
        .notification-time{color:#666;font-size:0.85rem}
        .notification-thumb{width:80px;height:45px;border-radius:6px;object-fit:cover;background:#242424;flex-shrink:0}
        
        .loading{text-align:center;padding:4rem}
        .spinner{width:40px;height:40px;border:3px solid #2A2A2A;border-top-color:#F5A623;border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 1rem}
        @keyframes spin{to{transform:rotate(360deg)}}
        
        .empty-state{text-align:center;padding:4rem}
        .empty-state-icon{font-size:4rem;margin-bottom:1rem}
        .empty-state-title{font-family:'Bebas Neue',sans-serif;font-size:1.8rem;margin-bottom:0.5rem}
        .empty-state-text{color:#666}
        
        @media(max-width:768px){
            .navbar{padding:1rem}
            .main-content{padding:1rem}
            .page-header{flex-direction:column;gap:1rem;align-items:flex-start}
            .notification-thumb{display:none}
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <a href="index.html" class="logo">UNCAGED</a>
        <div class="nav-links">
            <a href="browse.html">Browse</a>
            <a href="dashboard.html">Dashboard</a>
            <div class="profile-dropdown">
                <button class="profile-btn" id="profileBtn">?</button>
                <div class="dropdown-menu" id="dropdownMenu">
                    <a href="dashboard.html">Dashboard</a>
                    <a href="my-videos.html">My Videos</a>
                    <a href="settings.html">Settings</a>
                    <a href="#" id="logoutBtn">Log Out</a>
                </div>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <div class="page-header">
            <h1 class="page-title">Notifications</h1>
            <button class="mark-all-btn" id="markAllBtn">Mark all as read</button>
        </div>

        <div class="filters">
            <button class="filter-btn active" data-filter="all">All</button>
            <button class="filter-btn" data-filter="unread">Unread</button>
            <button class="filter-btn" data-filter="likes">Likes</button>
            <button class="filter-btn" data-filter="comments">Comments</button>
            <button class="filter-btn" data-filter="subscribers">Subscribers</button>
        </div>

        <div class="loading" id="loadingState">
            <div class="spinner"></div>
            <p>Loading notifications...</p>
        </div>

        <div class="notifications-list" id="notificationsList" style="display:none"></div>

        <div class="empty-state" id="emptyState" style="display:none">
            <div class="empty-state-icon">üîî</div>
            <h2 class="empty-state-title">No notifications yet</h2>
            <p class="empty-state-text">When someone interacts with your content, you'll see it here</p>
        </div>
    </main>

    <script type="module">
        import{initializeApp}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import{getAuth,onAuthStateChanged,signOut}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import{getFirestore,collection,getDocs,query,where,orderBy,updateDoc,doc,writeBatch}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig={apiKey:"AIzaSyDNPN3jptNzbR8vWy5hnVCuLoIBK2AW_HQ",authDomain:"uncaged-85b49.firebaseapp.com",projectId:"uncaged-85b49",storageBucket:"uncaged-85b49.firebasestorage.app",messagingSenderId:"957750920887",appId:"1:957750920887:web:9af4d847dad76c876d2f32"};
        const app=initializeApp(firebaseConfig),auth=getAuth(app),db=getFirestore(app);
        
        const $=id=>document.getElementById(id);
        let currentUser=null,allNotifications=[],currentFilter='all';

        onAuthStateChanged(auth,async user=>{
            if(!user){window.location.href='login.html';return;}
            currentUser=user;
            $('profileBtn').textContent=(user.displayName||user.email)[0].toUpperCase();
            await loadNotifications();
        });

        $('profileBtn').onclick=()=>$('dropdownMenu').classList.toggle('show');
        document.onclick=e=>{if(!e.target.closest('.profile-dropdown'))$('dropdownMenu').classList.remove('show');};
        $('logoutBtn').onclick=async e=>{e.preventDefault();await signOut(auth);window.location.href='index.html';};

        document.querySelectorAll('.filter-btn').forEach(btn=>{
            btn.onclick=()=>{
                document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
                btn.classList.add('active');
                currentFilter=btn.dataset.filter;
                displayNotifications();
            };
        });

        $('markAllBtn').onclick=async()=>{
            try{
                const batch=writeBatch(db);
                allNotifications.filter(n=>!n.read).forEach(n=>{
                    batch.update(doc(db,'notifications',n.id),{read:true});
                });
                await batch.commit();
                allNotifications.forEach(n=>n.read=true);
                displayNotifications();
            }catch(e){console.error(e);}
        };

        async function loadNotifications(){
            try{
                const q=query(collection(db,'notifications'),where('userId','==',currentUser.uid),orderBy('createdAt','desc'));
                const snap=await getDocs(q);
                allNotifications=snap.docs.map(d=>({id:d.id,...d.data()}));
                displayNotifications();
            }catch(err){
                console.error(err);
                $('loadingState').style.display='none';
                $('emptyState').style.display='block';
            }
        }

        function displayNotifications(){
            let filtered=[...allNotifications];
            
            if(currentFilter==='unread')filtered=filtered.filter(n=>!n.read);
            else if(currentFilter==='likes')filtered=filtered.filter(n=>n.type==='like');
            else if(currentFilter==='comments')filtered=filtered.filter(n=>n.type==='comment');
            else if(currentFilter==='subscribers')filtered=filtered.filter(n=>n.type==='subscriber');

            $('loadingState').style.display='none';

            if(filtered.length===0){
                $('notificationsList').style.display='none';
                $('emptyState').style.display='block';
                return;
            }

            $('emptyState').style.display='none';
            $('notificationsList').style.display='flex';

            $('notificationsList').innerHTML=filtered.map(n=>{
                const iconClass=n.type==='like'?'like':n.type==='comment'?'comment':'subscriber';
                const icon=n.type==='like'?'‚ù§Ô∏è':n.type==='comment'?'üí¨':'üë§';
                return`
                    <div class="notification-item ${n.read?'':'unread'}" data-id="${n.id}" data-video="${n.videoId||''}">
                        <div class="notification-icon ${iconClass}">${icon}</div>
                        <div class="notification-content">
                            <p class="notification-text">${n.text||'New notification'}</p>
                            <span class="notification-time">${getTimeAgo(n.createdAt?.toDate())}</span>
                        </div>
                    </div>
                `;
            }).join('');

            // Click handlers
            document.querySelectorAll('.notification-item').forEach(item=>{
                item.onclick=async()=>{
                    const id=item.dataset.id;
                    const videoId=item.dataset.video;
                    
                    // Mark as read
                    if(item.classList.contains('unread')){
                        await updateDoc(doc(db,'notifications',id),{read:true});
                        item.classList.remove('unread');
                        const n=allNotifications.find(x=>x.id===id);
                        if(n)n.read=true;
                    }
                    
                    // Navigate to video if exists
                    if(videoId)window.location.href=`watch.html?v=${videoId}`;
                };
            });
        }

        function getTimeAgo(date){
            if(!date)return'';
            const s=Math.floor((new Date()-date)/1000);
            const i={year:31536000,month:2592000,week:604800,day:86400,hour:3600,minute:60};
            for(const[u,v]of Object.entries(i)){const n=Math.floor(s/v);if(n>=1)return`${n} ${u}${n!==1?'s':''} ago`;}
            return'Just now';
        }
    </script>
</body>
</html>
