<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNCAGED | Playlists</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--bg-primary:#0D0D0D;--bg-secondary:#1A1A1A;--bg-tertiary:#242424;--accent-gold:#F5A623;--text-primary:#FFFFFF;--text-secondary:#B3B3B3;--text-muted:#666666;--border-color:#2A2A2A}
        body{font-family:'DM Sans',sans-serif;background:var(--bg-primary);color:var(--text-primary);min-height:100vh}
        .header{position:fixed;top:0;left:0;right:0;height:60px;background:rgba(13,13,13,0.95);backdrop-filter:blur(10px);display:flex;align-items:center;justify-content:space-between;padding:0 30px;z-index:1000;border-bottom:1px solid var(--border-color)}
        .header-left{display:flex;align-items:center;gap:30px}
        .logo{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:3px;background:linear-gradient(135deg,var(--accent-gold),#D4880F);-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-decoration:none}
        .nav-links{display:flex;gap:25px}
        .nav-links a{color:var(--text-secondary);text-decoration:none;font-size:14px}
        .nav-links a:hover{color:var(--text-primary)}
        .profile-btn{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--accent-gold),#D4880F);display:flex;align-items:center;justify-content:center;font-weight:700;color:#000;cursor:pointer;font-size:14px;border:none;position:relative}
        .dropdown{position:absolute;top:calc(100% + 10px);right:0;background:var(--bg-secondary);border-radius:12px;padding:10px 0;min-width:200px;box-shadow:0 10px 40px rgba(0,0,0,0.5);display:none;border:1px solid var(--border-color)}
        .dropdown.show{display:block}
        .dropdown a{display:block;padding:12px 20px;color:var(--text-secondary);text-decoration:none;font-size:14px}
        .dropdown a:hover{background:var(--bg-tertiary);color:var(--text-primary)}
        .dropdown .divider{height:1px;background:var(--border-color);margin:8px 0}

        .main{max-width:1200px;margin:0 auto;padding:80px 30px 40px}
        .page-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px}
        .page-title{font-family:'Bebas Neue',sans-serif;font-size:32px;letter-spacing:2px}
        .create-btn{display:flex;align-items:center;gap:8px;background:linear-gradient(135deg,var(--accent-gold),#D4880F);color:#000;padding:10px 20px;border-radius:20px;border:none;cursor:pointer;font-weight:600;font-size:14px}
        .create-btn svg{width:18px;height:18px}

        .playlists-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px}
        
        .playlist-card{background:var(--bg-secondary);border-radius:12px;overflow:hidden;cursor:pointer;transition:transform 0.2s}
        .playlist-card:hover{transform:translateY(-5px)}
        .playlist-thumb{position:relative;width:100%;aspect-ratio:16/9;background:var(--bg-tertiary);display:grid;grid-template-columns:1fr 1fr;grid-template-rows:1fr 1fr;gap:2px}
        .playlist-thumb img{width:100%;height:100%;object-fit:cover}
        .playlist-thumb .thumb-placeholder{background:var(--bg-tertiary);display:flex;align-items:center;justify-content:center}
        .playlist-thumb .thumb-placeholder svg{width:24px;height:24px;color:var(--text-muted)}
        .playlist-count{position:absolute;bottom:8px;right:8px;background:rgba(0,0,0,0.8);padding:4px 10px;border-radius:4px;font-size:12px;display:flex;align-items:center;gap:5px}
        .playlist-count svg{width:14px;height:14px}
        .playlist-info{padding:15px}
        .playlist-name{font-size:16px;font-weight:600;margin-bottom:6px}
        .playlist-meta{color:var(--text-muted);font-size:13px}
        .playlist-visibility{display:inline-flex;align-items:center;gap:4px;margin-top:8px;font-size:12px;color:var(--text-muted)}
        .playlist-visibility svg{width:14px;height:14px}

        /* Default playlists */
        .default-playlists{margin-bottom:40px}
        .section-title{font-size:18px;font-weight:600;margin-bottom:20px}
        .default-card{display:flex;gap:15px;background:var(--bg-secondary);border-radius:12px;padding:15px;cursor:pointer}
        .default-card:hover{background:var(--bg-tertiary)}
        .default-icon{width:50px;height:50px;border-radius:8px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
        .default-icon.liked{background:rgba(220,53,69,0.2);color:#DC3545}
        .default-icon.watch-later{background:rgba(0,123,255,0.2);color:#007BFF}
        .default-icon svg{width:24px;height:24px}
        .default-info h3{font-size:15px;margin-bottom:4px}
        .default-info p{color:var(--text-muted);font-size:13px}

        .empty-state{text-align:center;padding:60px 20px}
        .empty-state svg{width:80px;height:80px;color:var(--text-muted);margin-bottom:20px}
        .empty-state h2{font-size:22px;margin-bottom:10px}
        .empty-state p{color:var(--text-muted);margin-bottom:20px}

        /* Modal */
        .modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);display:none;align-items:center;justify-content:center;z-index:2000}
        .modal-overlay.show{display:flex}
        .modal{background:var(--bg-secondary);border-radius:14px;padding:25px;max-width:420px;width:90%}
        .modal h3{margin-bottom:20px}
        .modal .form-group{margin-bottom:15px}
        .modal .form-group label{display:block;margin-bottom:6px;font-size:13px;color:var(--text-secondary)}
        .modal .form-group input,.modal .form-group select{width:100%;padding:10px;background:var(--bg-tertiary);border:1px solid var(--border-color);border-radius:6px;color:var(--text-primary);font-size:14px}
        .modal .form-group input:focus{outline:none;border-color:var(--accent-gold)}
        .modal-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:20px}
        .modal-btn{padding:10px 20px;border-radius:8px;border:none;cursor:pointer;font-weight:600;font-size:14px}
        .modal-btn.cancel{background:var(--bg-tertiary);color:var(--text-primary)}
        .modal-btn.submit{background:linear-gradient(135deg,var(--accent-gold),#D4880F);color:#000}

        .loading{text-align:center;padding:60px}
        .loading-spinner{width:40px;height:40px;border:3px solid var(--border-color);border-top-color:var(--accent-gold);border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 15px}
        @keyframes spin{to{transform:rotate(360deg)}}

        @media(max-width:768px){.main{padding:70px 15px 20px}.page-header{flex-direction:column;gap:15px;align-items:flex-start}.nav-links{display:none}}
    </style>
</head>
<body>
    <header class="header">
        <div class="header-left">
            <a href="index.html" class="logo">UNCAGED</a>
            <nav class="nav-links">
                <a href="browse.html">Browse</a>
                <a href="subscriptions.html">Subscriptions</a>
                <a href="playlists.html" style="color:var(--text-primary)">Playlists</a>
            </nav>
        </div>
        <button class="profile-btn" id="profileBtn">V
            <div class="dropdown" id="profileDropdown">
                <a href="dashboard.html">Dashboard</a>
                <a href="my-videos.html">My Videos</a>
                <div class="divider"></div>
                <a href="subscriptions.html">Subscriptions</a>
                <a href="history.html">History</a>
                <a href="playlists.html">Playlists</a>
                <div class="divider"></div>
                <a href="settings.html">Settings</a>
                <a href="#" id="logoutBtn">Log Out</a>
            </div>
        </button>
    </header>

    <main class="main">
        <div class="page-header">
            <h1 class="page-title">Playlists</h1>
            <button class="create-btn" id="createBtn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                New Playlist
            </button>
        </div>

        <!-- Default Playlists -->
        <div class="default-playlists">
            <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:15px">
                <div class="default-card" onclick="location.href='liked-videos.html'">
                    <div class="default-icon liked">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/></svg>
                    </div>
                    <div class="default-info">
                        <h3>Liked Videos</h3>
                        <p id="likedCount">0 videos</p>
                    </div>
                </div>
                <div class="default-card" onclick="location.href='watch-later.html'">
                    <div class="default-icon watch-later">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                    </div>
                    <div class="default-info">
                        <h3>Watch Later</h3>
                        <p id="watchLaterCount">0 videos</p>
                    </div>
                </div>
            </div>
        </div>

        <h2 class="section-title">Your Playlists</h2>
        <div id="playlistsContent">
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading playlists...</p>
            </div>
        </div>
    </main>

    <!-- Create Playlist Modal -->
    <div class="modal-overlay" id="createModal">
        <div class="modal">
            <h3>Create New Playlist</h3>
            <form id="createForm">
                <div class="form-group">
                    <label>Playlist Name</label>
                    <input type="text" id="playlistName" required placeholder="My Awesome Playlist" maxlength="100">
                </div>
                <div class="form-group">
                    <label>Visibility</label>
                    <select id="playlistVisibility">
                        <option value="private">Private - Only you can see</option>
                        <option value="public">Public - Anyone can see</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="modal-btn cancel" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="modal-btn submit">Create</button>
                </div>
            </form>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, query, where, getDocs, addDoc, serverTimestamp, orderBy } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const app = initializeApp({
            apiKey: "AIzaSyDNPN3jptNzbR8vWy5hnVCuLoIBK2AW_HQ",
            authDomain: "uncaged-85b49.firebaseapp.com",
            projectId: "uncaged-85b49",
            storageBucket: "uncaged-85b49.firebasestorage.app",
            messagingSenderId: "957750920887",
            appId: "1:957750920887:web:9af4d847dad76c876d2f32"
        });
        const auth = getAuth(app);
        const db = getFirestore(app);
        let currentUser = null;
        let playlists = [];

        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                location.href = 'login.html';
                return;
            }
            currentUser = user;
            document.getElementById('profileBtn').childNodes[0].textContent = (user.displayName || user.email)[0].toUpperCase();
            loadPlaylists();
        });

        // Dropdown
        document.getElementById('profileBtn').onclick = (e) => {
            e.stopPropagation();
            document.getElementById('profileDropdown').classList.toggle('show');
        };
        document.onclick = () => {
            document.getElementById('profileDropdown').classList.remove('show');
            document.getElementById('createModal').classList.remove('show');
        };
        document.querySelectorAll('.dropdown, .modal').forEach(d => d.onclick = e => e.stopPropagation());
        document.getElementById('logoutBtn').onclick = async (e) => {
            e.preventDefault();
            await signOut(auth);
            location.href = 'index.html';
        };

        async function loadPlaylists() {
            const container = document.getElementById('playlistsContent');
            
            try {
                const snap = await getDocs(
                    query(
                        collection(db, 'playlists'),
                        where('userId', '==', currentUser.uid),
                        orderBy('createdAt', 'desc')
                    )
                );

                playlists = [];
                snap.forEach(d => playlists.push({ id: d.id, ...d.data() }));

                if (playlists.length === 0) {
                    showEmptyState();
                    return;
                }

                renderPlaylists();
            } catch (e) {
                console.error(e);
                showEmptyState();
            }
        }

        function showEmptyState() {
            document.getElementById('playlistsContent').innerHTML = `
                <div class="empty-state">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="8" y1="6" x2="21" y2="6"/>
                        <line x1="8" y1="12" x2="21" y2="12"/>
                        <line x1="8" y1="18" x2="21" y2="18"/>
                        <line x1="3" y1="6" x2="3.01" y2="6"/>
                        <line x1="3" y1="12" x2="3.01" y2="12"/>
                        <line x1="3" y1="18" x2="3.01" y2="18"/>
                    </svg>
                    <h2>No playlists yet</h2>
                    <p>Create a playlist to organize your favorite videos</p>
                </div>
            `;
        }

        function renderPlaylists() {
            const container = document.getElementById('playlistsContent');
            
            container.innerHTML = `
                <div class="playlists-grid">
                    ${playlists.map(p => {
                        const thumbs = p.thumbnails || [];
                        return `
                            <div class="playlist-card" onclick="location.href='playlist.html?id=${p.id}'">
                                <div class="playlist-thumb">
                                    ${thumbs[0] ? `<img src="${thumbs[0]}" onerror="this.parentElement.innerHTML='<div class=thumb-placeholder><svg viewBox=\\'0 0 24 24\\' fill=\\'none\\' stroke=\\'currentColor\\' stroke-width=\\'2\\'><polygon points=\\'5 3 19 12 5 21 5 3\\'/></svg></div>'">` : '<div class="thumb-placeholder"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg></div>'}
                                    ${thumbs[1] ? `<img src="${thumbs[1]}">` : '<div class="thumb-placeholder"></div>'}
                                    ${thumbs[2] ? `<img src="${thumbs[2]}">` : '<div class="thumb-placeholder"></div>'}
                                    ${thumbs[3] ? `<img src="${thumbs[3]}">` : '<div class="thumb-placeholder"></div>'}
                                    <div class="playlist-count">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                                        ${p.videoCount || 0}
                                    </div>
                                </div>
                                <div class="playlist-info">
                                    <div class="playlist-name">${p.name}</div>
                                    <div class="playlist-meta">${p.videoCount || 0} videos</div>
                                    <div class="playlist-visibility">
                                        ${p.visibility === 'public' 
                                            ? '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg> Public'
                                            : '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg> Private'}
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        // Create playlist modal
        document.getElementById('createBtn').onclick = (e) => {
            e.stopPropagation();
            document.getElementById('createModal').classList.add('show');
        };

        window.closeModal = () => {
            document.getElementById('createModal').classList.remove('show');
            document.getElementById('createForm').reset();
        };

        document.getElementById('createForm').onsubmit = async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('playlistName').value.trim();
            const visibility = document.getElementById('playlistVisibility').value;
            
            if (!name) return;
            
            try {
                const docRef = await addDoc(collection(db, 'playlists'), {
                    userId: currentUser.uid,
                    name,
                    visibility,
                    videoCount: 0,
                    thumbnails: [],
                    createdAt: serverTimestamp()
                });
                
                playlists.unshift({
                    id: docRef.id,
                    name,
                    visibility,
                    videoCount: 0,
                    thumbnails: []
                });
                
                closeModal();
                renderPlaylists();
            } catch (err) {
                alert('Error creating playlist: ' + err.message);
            }
        };
    </script>
</body>
</html>
