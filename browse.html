<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browse - UNCAGED</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'DM Sans',sans-serif;background:#0D0D0D;color:#FFF;min-height:100vh}
        .navbar{display:flex;justify-content:space-between;align-items:center;padding:1rem 2rem;background:#1A1A1A;border-bottom:1px solid #2A2A2A;position:sticky;top:0;z-index:100}
        .logo{font-family:'Bebas Neue',sans-serif;font-size:2rem;background:linear-gradient(135deg,#F5A623,#D4880F);-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-decoration:none}
        .nav-links{display:flex;align-items:center;gap:1.5rem}
        .nav-links a{color:#B3B3B3;text-decoration:none;font-weight:500}.nav-links a:hover{color:#F5A623}
        .search-box{display:flex;background:#242424;border-radius:24px;overflow:hidden;border:1px solid #2A2A2A}
        .search-box input{background:none;border:none;padding:0.5rem 1rem;color:#FFF;width:250px;font-family:'DM Sans',sans-serif}
        .search-box input:focus{outline:none}
        .search-box button{background:none;border:none;padding:0.5rem 1rem;color:#B3B3B3;cursor:pointer}
        .profile-dropdown{position:relative}
        .profile-btn{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,#F5A623,#D4880F);border:none;cursor:pointer;font-weight:600;color:#0D0D0D}
        .dropdown-menu{position:absolute;top:50px;right:0;background:#1A1A1A;border:1px solid #2A2A2A;border-radius:8px;min-width:200px;display:none;z-index:200}
        .dropdown-menu.show{display:block}
        .dropdown-menu a{display:block;padding:.8rem 1rem;color:#B3B3B3;text-decoration:none}
        .dropdown-menu a:hover{background:#242424;color:#F5A623}
        
        .main-content{max-width:1400px;margin:0 auto;padding:2rem}
        .page-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;flex-wrap:wrap;gap:1rem}
        .page-title{font-family:'Bebas Neue',sans-serif;font-size:2.5rem}
        
        .filters-bar{display:flex;gap:1rem;align-items:center;flex-wrap:wrap}
        .filter-select{padding:0.6rem 1rem;background:#1A1A1A;border:1px solid #2A2A2A;border-radius:8px;color:#FFF;font-family:'DM Sans',sans-serif;cursor:pointer}
        .filter-select:focus{outline:none;border-color:#F5A623}
        
        .categories{display:flex;gap:0.75rem;margin-bottom:2rem;overflow-x:auto;padding-bottom:0.5rem}
        .category-btn{padding:0.6rem 1.25rem;background:#1A1A1A;border:1px solid #2A2A2A;border-radius:20px;color:#B3B3B3;cursor:pointer;font-family:'DM Sans',sans-serif;white-space:nowrap;transition:all 0.2s}
        .category-btn:hover,.category-btn.active{border-color:#F5A623;color:#F5A623;background:rgba(245,166,35,0.1)}
        
        .section{margin-bottom:3rem}
        .section-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}
        .section-title{font-family:'Bebas Neue',sans-serif;font-size:1.5rem}
        .see-all{color:#F5A623;text-decoration:none;font-weight:500}
        .see-all:hover{text-decoration:underline}
        
        .videos-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1.5rem}
        
        .video-card{background:#1A1A1A;border-radius:12px;overflow:hidden;transition:transform 0.2s,box-shadow 0.2s;border:1px solid transparent}
        .video-card:hover{transform:translateY(-4px);box-shadow:0 8px 30px rgba(0,0,0,0.3);border-color:#2A2A2A}
        .video-card a{text-decoration:none;color:inherit}
        .thumbnail{position:relative;aspect-ratio:16/9;background:#242424}
        .thumbnail img{width:100%;height:100%;object-fit:cover}
        .video-info{padding:1rem}
        .video-header{display:flex;gap:0.75rem}
        .creator-avatar{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,#F5A623,#D4880F);display:flex;align-items:center;justify-content:center;font-weight:600;font-size:0.85rem;color:#0D0D0D;flex-shrink:0;text-decoration:none}
        .video-details{flex:1;min-width:0}
        .video-title{font-weight:600;margin-bottom:0.25rem;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;line-height:1.3}
        .video-meta{color:#666;font-size:0.85rem}
        .creator-name{color:#B3B3B3;text-decoration:none}
        .creator-name:hover{color:#F5A623}
        
        .trending-badge{position:absolute;top:8px;left:8px;background:linear-gradient(135deg,#F5A623,#D4880F);color:#0D0D0D;padding:0.25rem 0.5rem;border-radius:4px;font-size:0.75rem;font-weight:600}
        
        .loading{text-align:center;padding:4rem}
        .spinner{width:40px;height:40px;border:3px solid #2A2A2A;border-top-color:#F5A623;border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 1rem}
        @keyframes spin{to{transform:rotate(360deg)}}
        
        .empty-state{text-align:center;padding:4rem;color:#666}
        .empty-state-icon{font-size:4rem;margin-bottom:1rem}
        
        @media(max-width:768px){
            .navbar{padding:1rem}
            .search-box{display:none}
            .main-content{padding:1rem}
            .page-header{flex-direction:column;align-items:flex-start}
            .videos-grid{grid-template-columns:1fr}
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <a href="index.html" class="logo">UNCAGED</a>
        <div class="search-box">
            <input type="text" placeholder="Search videos..." id="searchInput">
            <button id="searchBtn">üîç</button>
        </div>
        <div class="nav-links">
            <a href="upload.html">Upload</a>
            <div class="profile-dropdown">
                <button class="profile-btn" id="profileBtn">?</button>
                <div class="dropdown-menu" id="dropdownMenu">
                    <a href="dashboard.html">Dashboard</a>
                    <a href="my-videos.html">My Videos</a>
                    <a href="history.html">History</a>
                    <a href="notifications.html">Notifications</a>
                    <a href="settings.html">Settings</a>
                    <a href="#" id="logoutBtn">Log Out</a>
                </div>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <div class="page-header">
            <h1 class="page-title">Browse Videos</h1>
            <div class="filters-bar">
                <select class="filter-select" id="sortSelect">
                    <option value="recent">Newest</option>
                    <option value="views">Most Viewed</option>
                    <option value="likes">Most Liked</option>
                    <option value="trending">Trending</option>
                </select>
            </div>
        </div>

        <div class="categories" id="categories">
            <button class="category-btn active" data-category="all">All</button>
            <button class="category-btn" data-category="entertainment">üé¨ Entertainment</button>
            <button class="category-btn" data-category="music">üéµ Music</button>
            <button class="category-btn" data-category="gaming">üéÆ Gaming</button>
            <button class="category-btn" data-category="sports">‚öΩ Sports</button>
            <button class="category-btn" data-category="education">üìö Education</button>
            <button class="category-btn" data-category="howto">üí° How-to</button>
            <button class="category-btn" data-category="travel">‚úàÔ∏è Travel</button>
            <button class="category-btn" data-category="comedy">üòÇ Comedy</button>
            <button class="category-btn" data-category="news">üì∞ News</button>
            <button class="category-btn" data-category="science">üî¨ Science</button>
        </div>

        <div class="loading" id="loadingState">
            <div class="spinner"></div>
            <p>Loading videos...</p>
        </div>

        <div id="contentArea" style="display:none">
            <section class="section" id="trendingSection">
                <div class="section-header">
                    <h2 class="section-title">üî• Trending Now</h2>
                </div>
                <div class="videos-grid" id="trendingGrid"></div>
            </section>

            <section class="section" id="allVideosSection">
                <div class="section-header">
                    <h2 class="section-title" id="sectionTitle">All Videos</h2>
                </div>
                <div class="videos-grid" id="videosGrid"></div>
            </section>
        </div>

        <div class="empty-state" id="emptyState" style="display:none">
            <div class="empty-state-icon">üìπ</div>
            <h2>No videos found</h2>
            <p>Be the first to upload in this category!</p>
        </div>
    </main>

    <script type="module">
        import{initializeApp}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import{getAuth,onAuthStateChanged,signOut}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import{getFirestore,collection,getDocs,query,where,orderBy,limit}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig={apiKey:"AIzaSyDNPN3jptNzbR8vWy5hnVCuLoIBK2AW_HQ",authDomain:"uncaged-85b49.firebaseapp.com",projectId:"uncaged-85b49",storageBucket:"uncaged-85b49.firebasestorage.app",messagingSenderId:"957750920887",appId:"1:957750920887:web:9af4d847dad76c876d2f32"};
        const app=initializeApp(firebaseConfig),auth=getAuth(app),db=getFirestore(app);
        
        const $=id=>document.getElementById(id);
        let allVideos=[];
        let currentCategory='all';
        let currentSort='recent';

        onAuthStateChanged(auth,user=>{
            if(user)$('profileBtn').textContent=(user.displayName||user.email)[0].toUpperCase();
        });

        $('profileBtn').onclick=()=>$('dropdownMenu').classList.toggle('show');
        document.onclick=e=>{if(!e.target.closest('.profile-dropdown'))$('dropdownMenu').classList.remove('show');};
        $('logoutBtn').onclick=async e=>{e.preventDefault();await signOut(auth);window.location.href='index.html';};

        $('searchBtn').onclick=()=>{const q=$('searchInput').value.trim();if(q)window.location.href=`search.html?q=${encodeURIComponent(q)}`;};
        $('searchInput').onkeypress=e=>{if(e.key==='Enter'){const q=$('searchInput').value.trim();if(q)window.location.href=`search.html?q=${encodeURIComponent(q)}`;}};

        document.querySelectorAll('.category-btn').forEach(btn=>{
            btn.onclick=()=>{
                document.querySelectorAll('.category-btn').forEach(b=>b.classList.remove('active'));
                btn.classList.add('active');
                currentCategory=btn.dataset.category;
                displayVideos();
            };
        });

        $('sortSelect').onchange=()=>{currentSort=$('sortSelect').value;displayVideos();};

        async function loadVideos(){
            try{
                const q=query(collection(db,'videos'),where('visibility','==','public'),where('status','==','active'));
                const snap=await getDocs(q);
                allVideos=snap.docs.map(d=>({id:d.id,...d.data()}));
                displayVideos();
            }catch(err){
                console.error(err);
                $('loadingState').style.display='none';
                $('emptyState').style.display='block';
            }
        }

        function displayVideos(){
            let filtered=currentCategory==='all'?[...allVideos]:allVideos.filter(v=>v.category===currentCategory);
            
            // Calculate trending score (views + likes in last 7 days weighted)
            const now=new Date();
            const weekAgo=new Date(now.getTime()-7*24*60*60*1000);
            filtered.forEach(v=>{
                const isRecent=v.createdAt?.toDate()>=weekAgo;
                v.trendingScore=(v.views||0)*0.5+(v.likes||0)*2+(isRecent?1000:0);
            });

            // Sort
            if(currentSort==='recent')filtered.sort((a,b)=>(b.createdAt?.toDate()||0)-(a.createdAt?.toDate()||0));
            else if(currentSort==='views')filtered.sort((a,b)=>(b.views||0)-(a.views||0));
            else if(currentSort==='likes')filtered.sort((a,b)=>(b.likes||0)-(a.likes||0));
            else if(currentSort==='trending')filtered.sort((a,b)=>b.trendingScore-a.trendingScore);

            $('loadingState').style.display='none';

            if(filtered.length===0){
                $('contentArea').style.display='none';
                $('emptyState').style.display='block';
                return;
            }

            $('emptyState').style.display='none';
            $('contentArea').style.display='block';

            // Trending section (top 4 by trending score)
            const trending=[...allVideos].sort((a,b)=>b.trendingScore-a.trendingScore).slice(0,4);
            if(currentCategory==='all'&&currentSort==='recent'){
                $('trendingSection').style.display='block';
                $('trendingGrid').innerHTML=trending.map(v=>renderVideoCard(v,true)).join('');
            }else{
                $('trendingSection').style.display='none';
            }

            // Update section title
            const categoryNames={all:'All Videos',entertainment:'Entertainment',music:'Music',gaming:'Gaming',sports:'Sports',education:'Education',howto:'How-to & Style',travel:'Travel',comedy:'Comedy',news:'News',science:'Science & Tech'};
            $('sectionTitle').textContent=categoryNames[currentCategory]||'Videos';

            // Main grid
            $('videosGrid').innerHTML=filtered.map(v=>renderVideoCard(v,false)).join('');
        }

        function renderVideoCard(v,showTrending){
            return`
                <div class="video-card">
                    <a href="watch.html?v=${v.id}">
                        <div class="thumbnail">
                            ${showTrending?'<span class="trending-badge">üî• Trending</span>':''}
                            <img src="${v.thumbnail||'https://via.placeholder.com/320x180/242424/666?text=Video'}" alt="${v.title||'Video'}" onerror="this.src='https://via.placeholder.com/320x180/242424/666?text=Video'">
                        </div>
                        <div class="video-info">
                            <div class="video-header">
                                <a href="creator.html?id=${v.creatorId}" class="creator-avatar">${(v.creatorName||'?')[0].toUpperCase()}</a>
                                <div class="video-details">
                                    <h3 class="video-title">${v.title||'Untitled'}</h3>
                                    <div class="video-meta">
                                        <a href="creator.html?id=${v.creatorId}" class="creator-name">${v.creatorName||'Unknown'}</a><br>
                                        ${(v.views||0).toLocaleString()} views ‚Ä¢ ${getTimeAgo(v.createdAt?.toDate())}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
            `;
        }

        function getTimeAgo(date){
            if(!date)return'';
            const s=Math.floor((new Date()-date)/1000);
            const i={year:31536000,month:2592000,week:604800,day:86400,hour:3600,minute:60};
            for(const[u,v]of Object.entries(i)){const n=Math.floor(s/v);if(n>=1)return`${n} ${u}${n!==1?'s':''} ago`;}
            return'Just now';
        }

        loadVideos();
    </script>
</body>
</html>
