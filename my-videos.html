<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Videos - UNCAGED</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background-color: #0D0D0D;
            color: #FFFFFF;
            min-height: 100vh;
        }

        /* Navigation */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            background-color: #1A1A1A;
            border-bottom: 1px solid #2A2A2A;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            background: linear-gradient(135deg, #F5A623, #D4880F);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .nav-links a {
            color: #B3B3B3;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: #F5A623;
        }

        .upload-btn {
            background: linear-gradient(135deg, #F5A623, #D4880F);
            color: #0D0D0D;
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(245, 166, 35, 0.4);
        }

        .profile-dropdown {
            position: relative;
        }

        .profile-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #F5A623, #D4880F);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: #0D0D0D;
        }

        .dropdown-menu {
            position: absolute;
            top: 50px;
            right: 0;
            background: #1A1A1A;
            border: 1px solid #2A2A2A;
            border-radius: 8px;
            min-width: 200px;
            display: none;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-menu a {
            display: block;
            padding: 0.8rem 1rem;
            color: #B3B3B3;
            text-decoration: none;
            transition: background 0.3s;
        }

        .dropdown-menu a:hover {
            background: #242424;
            color: #F5A623;
        }

        /* Main Content */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .page-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2.5rem;
            color: #FFFFFF;
        }

        .video-count {
            color: #B3B3B3;
            font-size: 1rem;
            margin-top: 0.5rem;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
        }

        .filter-select {
            background: #1A1A1A;
            border: 1px solid #2A2A2A;
            color: #FFFFFF;
            padding: 0.6rem 1rem;
            border-radius: 8px;
            font-family: 'DM Sans', sans-serif;
            cursor: pointer;
        }

        .filter-select:focus {
            outline: none;
            border-color: #F5A623;
        }

        /* Video Grid */
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .video-card {
            background: #1A1A1A;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #2A2A2A;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .video-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
        }

        .thumbnail-container {
            position: relative;
            aspect-ratio: 16/9;
            background: #242424;
        }

        .thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .duration {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background: rgba(0, 0, 0, 0.8);
            color: #FFFFFF;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .visibility-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .visibility-badge.public {
            background: rgba(76, 175, 80, 0.9);
            color: #FFFFFF;
        }

        .visibility-badge.private {
            background: rgba(244, 67, 54, 0.9);
            color: #FFFFFF;
        }

        .visibility-badge.unlisted {
            background: rgba(255, 152, 0, 0.9);
            color: #FFFFFF;
        }

        .video-info {
            padding: 1rem;
        }

        .video-title {
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 0.5rem;
            color: #FFFFFF;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .video-meta {
            display: flex;
            gap: 1rem;
            color: #666666;
            font-size: 0.85rem;
            margin-bottom: 1rem;
        }

        .video-meta span {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .video-actions {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            flex: 1;
            padding: 0.6rem;
            border: none;
            border-radius: 6px;
            font-family: 'DM Sans', sans-serif;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            text-align: center;
            font-size: 0.9rem;
        }

        .edit-btn {
            background: linear-gradient(135deg, #F5A623, #D4880F);
            color: #0D0D0D;
        }

        .edit-btn:hover {
            box-shadow: 0 4px 15px rgba(245, 166, 35, 0.4);
        }

        .view-btn {
            background: #242424;
            color: #FFFFFF;
            border: 1px solid #2A2A2A;
        }

        .view-btn:hover {
            border-color: #F5A623;
            color: #F5A623;
        }

        .delete-btn {
            background: transparent;
            color: #F44336;
            border: 1px solid #F44336;
        }

        .delete-btn:hover {
            background: #F44336;
            color: #FFFFFF;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .empty-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.8rem;
            color: #FFFFFF;
            margin-bottom: 0.5rem;
        }

        .empty-text {
            color: #666666;
            margin-bottom: 1.5rem;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 4rem;
            color: #B3B3B3;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #2A2A2A;
            border-top-color: #F5A623;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Delete Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: #1A1A1A;
            border-radius: 12px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            border: 1px solid #2A2A2A;
        }

        .modal-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: #F44336;
        }

        .modal-text {
            color: #B3B3B3;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
        }

        .modal-btn {
            flex: 1;
            padding: 0.8rem;
            border: none;
            border-radius: 8px;
            font-family: 'DM Sans', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .cancel-btn {
            background: #242424;
            color: #FFFFFF;
        }

        .confirm-delete-btn {
            background: #F44336;
            color: #FFFFFF;
        }

        .confirm-delete-btn:hover {
            background: #D32F2F;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .navbar {
                padding: 1rem;
            }

            .nav-links {
                display: none;
            }

            .main-content {
                padding: 1rem;
            }

            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .video-grid {
                grid-template-columns: 1fr;
            }

            .video-actions {
                flex-wrap: wrap;
            }

            .action-btn {
                flex: 1 1 45%;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <a href="index.html" class="logo">UNCAGED</a>
        <div class="nav-links">
            <a href="browse.html">Browse</a>
            <a href="dashboard.html">Dashboard</a>
            <a href="upload.html" class="upload-btn">Upload</a>
            <div class="profile-dropdown">
                <button class="profile-btn" id="profileBtn">?</button>
                <div class="dropdown-menu" id="dropdownMenu">
                    <a href="dashboard.html">Dashboard</a>
                    <a href="my-videos.html">My Videos</a>
                    <a href="analytics.html">Analytics</a>
                    <a href="earnings.html">Earnings</a>
                    <a href="settings.html">Settings</a>
                    <a href="#" id="logoutBtn">Log Out</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="page-header">
            <div>
                <h1 class="page-title">My Videos</h1>
                <p class="video-count" id="videoCount">Loading...</p>
            </div>
            <div class="header-actions">
                <select class="filter-select" id="visibilityFilter">
                    <option value="all">All Videos</option>
                    <option value="public">Public</option>
                    <option value="private">Private</option>
                    <option value="unlisted">Unlisted</option>
                </select>
                <select class="filter-select" id="sortFilter">
                    <option value="newest">Newest First</option>
                    <option value="oldest">Oldest First</option>
                    <option value="views">Most Views</option>
                    <option value="likes">Most Likes</option>
                </select>
            </div>
        </div>

        <!-- Loading State -->
        <div class="loading" id="loadingState">
            <div class="spinner"></div>
            <p>Loading your videos...</p>
        </div>

        <!-- Empty State -->
        <div class="empty-state" id="emptyState" style="display: none;">
            <div class="empty-icon">üé¨</div>
            <h2 class="empty-title">No Videos Yet</h2>
            <p class="empty-text">Upload your first video and start sharing your content with the world.</p>
            <a href="upload.html" class="upload-btn">Upload Video</a>
        </div>

        <!-- Video Grid -->
        <div class="video-grid" id="videoGrid"></div>
    </main>

    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal">
            <h2 class="modal-title">Delete Video?</h2>
            <p class="modal-text">Are you sure you want to delete "<span id="deleteVideoTitle"></span>"? This action cannot be undone.</p>
            <div class="modal-actions">
                <button class="modal-btn cancel-btn" id="cancelDelete">Cancel</button>
                <button class="modal-btn confirm-delete-btn" id="confirmDelete">Delete</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, query, where, orderBy, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDNPN3jptNzbR8vWy5hnVCuLoIBK2AW_HQ",
            authDomain: "uncaged-85b49.firebaseapp.com",
            projectId: "uncaged-85b49",
            storageBucket: "uncaged-85b49.firebasestorage.app",
            messagingSenderId: "957750920887",
            appId: "1:957750920887:web:9af4d847dad76c876d2f32"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        let allVideos = [];
        let videoToDelete = null;

        // DOM Elements
        const loadingState = document.getElementById('loadingState');
        const emptyState = document.getElementById('emptyState');
        const videoGrid = document.getElementById('videoGrid');
        const videoCount = document.getElementById('videoCount');
        const visibilityFilter = document.getElementById('visibilityFilter');
        const sortFilter = document.getElementById('sortFilter');
        const deleteModal = document.getElementById('deleteModal');
        const deleteVideoTitle = document.getElementById('deleteVideoTitle');
        const profileBtn = document.getElementById('profileBtn');
        const dropdownMenu = document.getElementById('dropdownMenu');

        // Auth State
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                profileBtn.textContent = user.displayName ? user.displayName.charAt(0).toUpperCase() : user.email.charAt(0).toUpperCase();
                loadVideos();
            } else {
                window.location.href = 'login.html';
            }
        });

        // Profile Dropdown
        profileBtn.addEventListener('click', () => {
            dropdownMenu.classList.toggle('show');
        });

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.profile-dropdown')) {
                dropdownMenu.classList.remove('show');
            }
        });

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', async (e) => {
            e.preventDefault();
            await signOut(auth);
            window.location.href = 'index.html';
        });

        // Load Videos
        async function loadVideos() {
            try {
                const videosRef = collection(db, 'videos');
                const q = query(
                    videosRef,
                    where('creatorId', '==', currentUser.uid),
                    orderBy('createdAt', 'desc')
                );

                const snapshot = await getDocs(q);
                allVideos = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));

                loadingState.style.display = 'none';
                renderVideos();
            } catch (error) {
                console.error('Error loading videos:', error);
                loadingState.innerHTML = '<p style="color: #F44336;">Error loading videos. Please try again.</p>';
            }
        }

        // Render Videos
        function renderVideos() {
            let filtered = [...allVideos];

            // Apply visibility filter
            const visibility = visibilityFilter.value;
            if (visibility !== 'all') {
                filtered = filtered.filter(v => v.visibility === visibility);
            }

            // Apply sort
            const sort = sortFilter.value;
            switch (sort) {
                case 'oldest':
                    filtered.sort((a, b) => a.createdAt?.toMillis() - b.createdAt?.toMillis());
                    break;
                case 'views':
                    filtered.sort((a, b) => (b.views || 0) - (a.views || 0));
                    break;
                case 'likes':
                    filtered.sort((a, b) => (b.likes || 0) - (a.likes || 0));
                    break;
                default:
                    filtered.sort((a, b) => b.createdAt?.toMillis() - a.createdAt?.toMillis());
            }

            // Update count
            videoCount.textContent = `${filtered.length} video${filtered.length !== 1 ? 's' : ''}`;

            // Show empty state or grid
            if (filtered.length === 0) {
                emptyState.style.display = 'block';
                videoGrid.style.display = 'none';
                return;
            }

            emptyState.style.display = 'none';
            videoGrid.style.display = 'grid';

            videoGrid.innerHTML = filtered.map(video => {
                const thumbnail = video.thumbnail || `https://vz-fa698983-d99.b-cdn.net/${video.bunnyVideoId}/thumbnail.jpg`;
                const date = video.createdAt?.toDate().toLocaleDateString() || 'Unknown';
                const views = video.views?.toLocaleString() || '0';
                const likes = video.likes?.toLocaleString() || '0';

                return `
                    <div class="video-card" data-id="${video.id}">
                        <div class="thumbnail-container">
                            <img src="${thumbnail}" alt="${video.title}" class="thumbnail" onerror="this.src='https://via.placeholder.com/320x180/242424/666666?text=No+Thumbnail'">
                            <span class="visibility-badge ${video.visibility || 'public'}">${video.visibility || 'public'}</span>
                        </div>
                        <div class="video-info">
                            <h3 class="video-title">${video.title || 'Untitled'}</h3>
                            <div class="video-meta">
                                <span>üëÅ ${views} views</span>
                                <span>‚ù§Ô∏è ${likes} likes</span>
                                <span>üìÖ ${date}</span>
                            </div>
                            <div class="video-actions">
                                <a href="edit-video.html?v=${video.id}" class="action-btn edit-btn">Edit</a>
                                <a href="watch.html?v=${video.id}" class="action-btn view-btn">View</a>
                                <button class="action-btn delete-btn" onclick="openDeleteModal('${video.id}', '${video.title?.replace(/'/g, "\\'")}')">Delete</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Filter listeners
        visibilityFilter.addEventListener('change', renderVideos);
        sortFilter.addEventListener('change', renderVideos);

        // Delete Modal Functions
        window.openDeleteModal = function(videoId, title) {
            videoToDelete = videoId;
            deleteVideoTitle.textContent = title || 'Untitled';
            deleteModal.classList.add('show');
        };

        document.getElementById('cancelDelete').addEventListener('click', () => {
            deleteModal.classList.remove('show');
            videoToDelete = null;
        });

        document.getElementById('confirmDelete').addEventListener('click', async () => {
            if (!videoToDelete) return;

            try {
                await deleteDoc(doc(db, 'videos', videoToDelete));
                allVideos = allVideos.filter(v => v.id !== videoToDelete);
                renderVideos();
                deleteModal.classList.remove('show');
                videoToDelete = null;
            } catch (error) {
                console.error('Error deleting video:', error);
                alert('Failed to delete video. Please try again.');
            }
        });

        // Close modal on overlay click
        deleteModal.addEventListener('click', (e) => {
            if (e.target === deleteModal) {
                deleteModal.classList.remove('show');
                videoToDelete = null;
            }
        });
    </script>
</body>
</html>
