<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creator - UNCAGED</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'DM Sans',sans-serif;background:#0D0D0D;color:#FFF;min-height:100vh}
        .navbar{display:flex;justify-content:space-between;align-items:center;padding:1rem 2rem;background:#1A1A1A;border-bottom:1px solid #2A2A2A;position:sticky;top:0;z-index:100}
        .logo{font-family:'Bebas Neue',sans-serif;font-size:2rem;background:linear-gradient(135deg,#F5A623,#D4880F);-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-decoration:none}
        .nav-links{display:flex;align-items:center;gap:1.5rem}
        .nav-links a{color:#B3B3B3;text-decoration:none;font-weight:500}.nav-links a:hover{color:#F5A623}
        .profile-dropdown{position:relative}
        .profile-btn{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,#F5A623,#D4880F);border:none;cursor:pointer;font-weight:600;color:#0D0D0D}
        .dropdown-menu{position:absolute;top:50px;right:0;background:#1A1A1A;border:1px solid #2A2A2A;border-radius:8px;min-width:200px;display:none;z-index:200}
        .dropdown-menu.show{display:block}
        .dropdown-menu a{display:block;padding:.8rem 1rem;color:#B3B3B3;text-decoration:none}
        .dropdown-menu a:hover{background:#242424;color:#F5A623}
        
        .creator-banner{height:200px;background:linear-gradient(135deg,#1A1A1A,#242424);position:relative}
        .creator-header{max-width:1200px;margin:0 auto;padding:0 2rem;transform:translateY(-50px)}
        .creator-info{display:flex;align-items:flex-end;gap:1.5rem;flex-wrap:wrap}
        .creator-avatar{width:150px;height:150px;border-radius:50%;background:linear-gradient(135deg,#F5A623,#D4880F);display:flex;align-items:center;justify-content:center;font-size:4rem;font-weight:600;color:#0D0D0D;border:4px solid #0D0D0D}
        .creator-details{flex:1;min-width:200px;padding-bottom:1rem}
        .creator-name{font-family:'Bebas Neue',sans-serif;font-size:2.5rem;margin-bottom:0.25rem}
        .creator-handle{color:#666;margin-bottom:0.5rem}
        .creator-stats{display:flex;gap:2rem;margin-bottom:1rem}
        .stat{text-align:center}
        .stat-value{font-size:1.5rem;font-weight:600}
        .stat-label{color:#666;font-size:0.85rem}
        .creator-bio{color:#B3B3B3;max-width:600px;line-height:1.5}
        .creator-actions{display:flex;gap:1rem;padding-bottom:1rem}
        .subscribe-btn{padding:0.75rem 2rem;background:linear-gradient(135deg,#F5A623,#D4880F);color:#0D0D0D;border:none;border-radius:24px;font-family:'DM Sans',sans-serif;font-weight:600;cursor:pointer;transition:all 0.2s}
        .subscribe-btn:hover{transform:translateY(-2px);box-shadow:0 4px 15px rgba(245,166,35,0.4)}
        .subscribe-btn.subscribed{background:#242424;color:#B3B3B3;border:1px solid #2A2A2A}
        .tip-btn{padding:0.75rem 1.5rem;background:#242424;color:#FFF;border:1px solid #2A2A2A;border-radius:24px;font-family:'DM Sans',sans-serif;font-weight:600;cursor:pointer;transition:all 0.2s}
        .tip-btn:hover{border-color:#F5A623;color:#F5A623}
        
        .main-content{max-width:1200px;margin:0 auto;padding:2rem}
        .tabs{display:flex;gap:0;border-bottom:1px solid #2A2A2A;margin-bottom:2rem}
        .tab{padding:1rem 2rem;color:#666;cursor:pointer;border-bottom:2px solid transparent;transition:all 0.2s;font-weight:500}
        .tab:hover{color:#FFF}
        .tab.active{color:#F5A623;border-color:#F5A623}
        
        .videos-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1.5rem}
        .video-card{background:#1A1A1A;border-radius:12px;overflow:hidden;transition:transform 0.2s;border:1px solid transparent}
        .video-card:hover{transform:translateY(-4px);border-color:#2A2A2A}
        .video-card a{text-decoration:none;color:inherit}
        .thumbnail{aspect-ratio:16/9;background:#242424}
        .thumbnail img{width:100%;height:100%;object-fit:cover}
        .video-info{padding:1rem}
        .video-title{font-weight:600;margin-bottom:0.5rem;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
        .video-meta{color:#666;font-size:0.85rem}
        
        .loading{text-align:center;padding:4rem}
        .spinner{width:40px;height:40px;border:3px solid #2A2A2A;border-top-color:#F5A623;border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 1rem}
        @keyframes spin{to{transform:rotate(360deg)}}
        
        .empty-state{text-align:center;padding:4rem;color:#666}
        
        .toast{position:fixed;bottom:2rem;left:50%;transform:translateX(-50%) translateY(100px);background:#1A1A1A;border:1px solid #2A2A2A;padding:1rem 1.5rem;border-radius:8px;transition:transform .3s;z-index:1001}
        .toast.show{transform:translateX(-50%) translateY(0)}
        .toast.success{border-color:#4CAF50}
        
        @media(max-width:768px){
            .navbar{padding:1rem}
            .creator-header{padding:0 1rem}
            .creator-info{flex-direction:column;align-items:center;text-align:center}
            .creator-avatar{width:100px;height:100px;font-size:2.5rem}
            .creator-stats{justify-content:center}
            .creator-actions{justify-content:center}
            .main-content{padding:1rem}
            .tabs{overflow-x:auto}
            .tab{padding:1rem}
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <a href="index.html" class="logo">UNCAGED</a>
        <div class="nav-links">
            <a href="browse.html">Browse</a>
            <div class="profile-dropdown">
                <button class="profile-btn" id="profileBtn">?</button>
                <div class="dropdown-menu" id="dropdownMenu">
                    <a href="dashboard.html">Dashboard</a>
                    <a href="my-videos.html">My Videos</a>
                    <a href="settings.html">Settings</a>
                    <a href="#" id="logoutBtn">Log Out</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="creator-banner"></div>
    
    <div class="creator-header">
        <div class="creator-info">
            <div class="creator-avatar" id="creatorAvatar">?</div>
            <div class="creator-details">
                <h1 class="creator-name" id="creatorName">Loading...</h1>
                <p class="creator-handle" id="creatorHandle">@username</p>
                <div class="creator-stats">
                    <div class="stat"><div class="stat-value" id="subCount">0</div><div class="stat-label">Subscribers</div></div>
                    <div class="stat"><div class="stat-value" id="videoCount">0</div><div class="stat-label">Videos</div></div>
                    <div class="stat"><div class="stat-value" id="viewCount">0</div><div class="stat-label">Total Views</div></div>
                </div>
                <p class="creator-bio" id="creatorBio"></p>
            </div>
            <div class="creator-actions">
                <button class="subscribe-btn" id="subscribeBtn">Subscribe</button>
                <button class="tip-btn" id="tipBtn">ðŸ’° Tip</button>
            </div>
        </div>
    </div>

    <main class="main-content">
        <div class="tabs">
            <div class="tab active" data-tab="videos">Videos</div>
            <div class="tab" data-tab="popular">Popular</div>
            <div class="tab" data-tab="latest">Latest</div>
        </div>

        <div class="loading" id="loadingState">
            <div class="spinner"></div>
            <p>Loading videos...</p>
        </div>

        <div class="videos-grid" id="videosGrid" style="display:none"></div>
        
        <div class="empty-state" id="emptyState" style="display:none">
            <p>No videos yet</p>
        </div>
    </main>

    <div class="toast" id="toast"><span id="toastMessage"></span></div>

    <script type="module">
        import{initializeApp}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import{getAuth,onAuthStateChanged,signOut}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import{getFirestore,doc,getDoc,getDocs,collection,query,where,orderBy,setDoc,deleteDoc,updateDoc,increment,addDoc,serverTimestamp}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig={apiKey:"AIzaSyDNPN3jptNzbR8vWy5hnVCuLoIBK2AW_HQ",authDomain:"uncaged-85b49.firebaseapp.com",projectId:"uncaged-85b49",storageBucket:"uncaged-85b49.firebasestorage.app",messagingSenderId:"957750920887",appId:"1:957750920887:web:9af4d847dad76c876d2f32"};
        const app=initializeApp(firebaseConfig),auth=getAuth(app),db=getFirestore(app);
        
        const $=id=>document.getElementById(id);
        const urlParams=new URLSearchParams(window.location.search);
        const creatorId=urlParams.get('id');
        if(!creatorId)window.location.href='browse.html';
        
        let currentUser=null,creatorData=null,creatorVideos=[],isSubscribed=false,currentTab='videos';

        onAuthStateChanged(auth,async user=>{
            currentUser=user;
            if(user)$('profileBtn').textContent=(user.displayName||user.email)[0].toUpperCase();
            await loadCreator();
        });

        $('profileBtn').onclick=()=>$('dropdownMenu').classList.toggle('show');
        document.onclick=e=>{if(!e.target.closest('.profile-dropdown'))$('dropdownMenu').classList.remove('show');};
        $('logoutBtn').onclick=async e=>{e.preventDefault();await signOut(auth);window.location.href='index.html';};

        document.querySelectorAll('.tab').forEach(tab=>{
            tab.onclick=()=>{
                document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
                tab.classList.add('active');
                currentTab=tab.dataset.tab;
                displayVideos();
            };
        });

        async function loadCreator(){
            try{
                const userDoc=await getDoc(doc(db,'users',creatorId));
                if(userDoc.exists()){
                    creatorData=userDoc.data();
                    $('creatorName').textContent=creatorData.displayName||creatorData.name||'Creator';
                    $('creatorHandle').textContent=`@${(creatorData.displayName||creatorData.email||'user').toLowerCase().replace(/\s+/g,'')}`;
                    $('creatorAvatar').textContent=(creatorData.displayName||creatorData.name||'?')[0].toUpperCase();
                    $('creatorBio').textContent=creatorData.bio||'';
                    $('subCount').textContent=(creatorData.subscribers||0).toLocaleString();
                    document.title=`${creatorData.displayName||'Creator'} - UNCAGED`;
                }

                // Load videos
                const q=query(collection(db,'videos'),where('creatorId','==',creatorId),where('visibility','==','public'),where('status','==','active'));
                const snap=await getDocs(q);
                creatorVideos=snap.docs.map(d=>({id:d.id,...d.data()}));
                
                $('videoCount').textContent=creatorVideos.length;
                $('viewCount').textContent=creatorVideos.reduce((sum,v)=>sum+(v.views||0),0).toLocaleString();

                // Check subscription
                if(currentUser){
                    const subDoc=await getDoc(doc(db,'subscriptions',`${currentUser.uid}_${creatorId}`));
                    if(subDoc.exists()){
                        isSubscribed=true;
                        $('subscribeBtn').textContent='Subscribed';
                        $('subscribeBtn').classList.add('subscribed');
                    }
                }

                displayVideos();
            }catch(err){
                console.error(err);
            }
        }

        function displayVideos(){
            let videos=[...creatorVideos];
            
            if(currentTab==='popular')videos.sort((a,b)=>(b.views||0)-(a.views||0));
            else if(currentTab==='latest')videos.sort((a,b)=>(b.createdAt?.toDate()||0)-(a.createdAt?.toDate()||0));
            else videos.sort((a,b)=>(b.createdAt?.toDate()||0)-(a.createdAt?.toDate()||0));

            $('loadingState').style.display='none';

            if(videos.length===0){
                $('videosGrid').style.display='none';
                $('emptyState').style.display='block';
                return;
            }

            $('emptyState').style.display='none';
            $('videosGrid').style.display='grid';

            $('videosGrid').innerHTML=videos.map(v=>`
                <div class="video-card">
                    <a href="watch.html?v=${v.id}">
                        <div class="thumbnail">
                            <img src="${v.thumbnail||'https://via.placeholder.com/320x180/242424/666?text=Video'}" alt="${v.title}" onerror="this.src='https://via.placeholder.com/320x180/242424/666?text=Video'">
                        </div>
                        <div class="video-info">
                            <h3 class="video-title">${v.title||'Untitled'}</h3>
                            <div class="video-meta">${(v.views||0).toLocaleString()} views â€¢ ${getTimeAgo(v.createdAt?.toDate())}</div>
                        </div>
                    </a>
                </div>
            `).join('');
        }

        $('subscribeBtn').onclick=async()=>{
            if(!currentUser){showToast('Please sign in');return;}
            if(creatorId===currentUser.uid){showToast('Cannot subscribe to yourself');return;}
            
            try{
                const ref=doc(db,'subscriptions',`${currentUser.uid}_${creatorId}`);
                if(isSubscribed){
                    await deleteDoc(ref);
                    await updateDoc(doc(db,'users',creatorId),{subscribers:increment(-1)});
                    isSubscribed=false;
                    $('subscribeBtn').textContent='Subscribe';
                    $('subscribeBtn').classList.remove('subscribed');
                    $('subCount').textContent=Math.max(0,parseInt($('subCount').textContent.replace(/,/g,''))-1).toLocaleString();
                }else{
                    await setDoc(ref,{subscriberId:currentUser.uid,creatorId,createdAt:serverTimestamp()});
                    await updateDoc(doc(db,'users',creatorId),{subscribers:increment(1)});
                    await addDoc(collection(db,'notifications'),{userId:creatorId,type:'subscriber',text:`${currentUser.displayName||'Someone'} subscribed to your channel`,read:false,createdAt:serverTimestamp()});
                    isSubscribed=true;
                    $('subscribeBtn').textContent='Subscribed';
                    $('subscribeBtn').classList.add('subscribed');
                    $('subCount').textContent=(parseInt($('subCount').textContent.replace(/,/g,''))+1).toLocaleString();
                    showToast('Subscribed!');
                }
            }catch(e){console.error(e);}
        };

        $('tipBtn').onclick=()=>showToast('Tipping coming soon!');

        function showToast(msg){$('toastMessage').textContent=msg;$('toast').className='toast success show';setTimeout(()=>$('toast').classList.remove('show'),3000);}
        function getTimeAgo(date){if(!date)return'';const s=Math.floor((new Date()-date)/1000);const i={year:31536000,month:2592000,week:604800,day:86400,hour:3600,minute:60};for(const[u,v]of Object.entries(i)){const n=Math.floor(s/v);if(n>=1)return`${n} ${u}${n!==1?'s':''} ago`;}return'Just now';}
    </script>
</body>
</html>
