<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNCAGED | Watch</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--bg-primary:#0D0D0D;--bg-secondary:#1A1A1A;--bg-tertiary:#242424;--accent-gold:#F5A623;--text-primary:#FFFFFF;--text-secondary:#B3B3B3;--text-muted:#666666;--border-color:#2A2A2A}
        body{font-family:'DM Sans',sans-serif;background:var(--bg-primary);color:var(--text-primary);min-height:100vh}
        .header{position:fixed;top:0;left:0;right:0;height:60px;background:rgba(13,13,13,0.95);backdrop-filter:blur(10px);display:flex;align-items:center;justify-content:space-between;padding:0 30px;z-index:1000;border-bottom:1px solid var(--border-color)}
        .logo{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:3px;background:linear-gradient(135deg,var(--accent-gold),#D4880F);-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-decoration:none}
        .nav-links{display:flex;gap:25px}
        .nav-links a{color:var(--text-secondary);text-decoration:none;font-size:14px}
        .header-right{display:flex;align-items:center;gap:15px}
        .upload-btn{background:var(--bg-tertiary);color:var(--text-primary);padding:8px 16px;border-radius:20px;text-decoration:none;font-size:14px;display:flex;align-items:center;gap:6px}
        .notif-link{position:relative;color:var(--text-secondary);padding:8px}
        .notif-link svg{width:22px;height:22px}
        .notif-badge{position:absolute;top:0;right:0;background:#DC3545;color:#fff;font-size:10px;padding:2px 5px;border-radius:10px}
        .profile-btn{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--accent-gold),#D4880F);display:flex;align-items:center;justify-content:center;font-weight:700;color:#000;cursor:pointer;font-size:14px;border:none;position:relative}
        .dropdown{position:absolute;top:calc(100% + 10px);right:0;background:var(--bg-secondary);border-radius:12px;padding:10px 0;min-width:200px;box-shadow:0 10px 40px rgba(0,0,0,0.5);display:none;border:1px solid var(--border-color)}
        .dropdown.show{display:block}
        .dropdown a{display:block;padding:12px 20px;color:var(--text-secondary);text-decoration:none;font-size:14px}
        .dropdown a:hover{background:var(--bg-tertiary)}
        .dropdown .divider{height:1px;background:var(--border-color);margin:8px 0}
        .auth-logged-out,.auth-logged-in{display:none;align-items:center;gap:15px}
        .btn-login{color:var(--text-primary);text-decoration:none}
        .btn-signup{background:linear-gradient(135deg,var(--accent-gold),#D4880F);color:#000;padding:10px 20px;border-radius:25px;text-decoration:none;font-weight:600}
        .main-content{display:flex;gap:25px;max-width:1500px;margin:0 auto;padding:75px 25px 40px}
        .video-section{flex:1;max-width:1000px}
        .sidebar{width:340px;flex-shrink:0}
        .video-container{position:relative;width:100%;padding-top:56.25%;background:#000;border-radius:12px;overflow:hidden;margin-bottom:15px}
        .video-container iframe{position:absolute;top:0;left:0;width:100%;height:100%;border:none}
        .video-title{font-size:20px;font-weight:600;margin-bottom:10px}
        .video-meta{color:var(--text-secondary);font-size:14px;margin-bottom:15px}
        .creator-row{display:flex;align-items:center;justify-content:space-between;padding:15px 0;border-top:1px solid var(--border-color);border-bottom:1px solid var(--border-color);margin-bottom:15px}
        .creator-info{display:flex;align-items:center;gap:12px}
        .creator-avatar{width:44px;height:44px;border-radius:50%;background:linear-gradient(135deg,var(--accent-gold),#D4880F);display:flex;align-items:center;justify-content:center;font-weight:700;color:#000;font-size:16px;cursor:pointer}
        .creator-name a{color:var(--text-primary);text-decoration:none;font-weight:600}
        .creator-subs{color:var(--text-muted);font-size:13px}
        .subscribe-btn{background:linear-gradient(135deg,var(--accent-gold),#D4880F);color:#000;padding:10px 20px;border-radius:20px;border:none;font-weight:600;cursor:pointer}
        .subscribe-btn.subscribed{background:var(--bg-tertiary);color:var(--text-primary)}
        .action-buttons{display:flex;gap:8px;margin-bottom:15px;flex-wrap:wrap}
        .action-btn{display:flex;align-items:center;gap:6px;padding:8px 14px;background:var(--bg-tertiary);border:none;border-radius:18px;color:var(--text-primary);cursor:pointer;font-size:13px}
        .action-btn:hover{background:var(--border-color)}
        .action-btn.active{background:var(--accent-gold);color:#000}
        .action-btn.report{margin-left:auto}
        .action-btn.report:hover{background:rgba(220,53,69,0.2);color:#DC3545}
        .action-btn svg{width:18px;height:18px}
        .description-box{background:var(--bg-secondary);border-radius:10px;padding:12px;margin-bottom:25px}
        .description-text{color:var(--text-secondary);font-size:13px;line-height:1.5;white-space:pre-wrap}
        .comments-section h3{font-size:16px;margin-bottom:15px}
        .comment-form{display:flex;gap:10px;margin-bottom:20px}
        .comment-form .avatar{width:36px;height:36px;border-radius:50%;background:var(--accent-gold);display:flex;align-items:center;justify-content:center;font-weight:700;color:#000;font-size:13px;flex-shrink:0}
        .comment-input-wrap{flex:1}
        .comment-input{width:100%;padding:10px;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:6px;color:var(--text-primary);font-size:13px;resize:none;font-family:inherit}
        .comment-input:focus{outline:none;border-color:var(--accent-gold)}
        .comment-actions{display:flex;justify-content:flex-end;gap:8px;margin-top:8px}
        .comment-actions button{padding:6px 14px;border-radius:15px;border:none;cursor:pointer;font-size:12px}
        .comment-actions .cancel{background:transparent;color:var(--text-secondary)}
        .comment-actions .submit{background:var(--accent-gold);color:#000;font-weight:600}
        .comment-actions .submit:disabled{opacity:0.5}
        .comments-list{display:flex;flex-direction:column;gap:15px}
        .comment{display:flex;gap:10px}
        .comment .avatar{width:36px;height:36px;border-radius:50%;background:var(--bg-tertiary);display:flex;align-items:center;justify-content:center;font-size:13px;flex-shrink:0}
        .comment-content{flex:1}
        .comment-author{font-size:13px;font-weight:600;margin-bottom:3px}
        .comment-author span{color:var(--text-muted);font-weight:400;margin-left:6px;font-size:11px}
        .comment-text{color:var(--text-secondary);font-size:13px}
        .sidebar-title{font-size:15px;font-weight:600;margin-bottom:15px}
        .related-video{display:flex;gap:8px;margin-bottom:12px;cursor:pointer}
        .related-video:hover .related-title{color:var(--accent-gold)}
        .related-thumb{width:150px;height:84px;background:var(--bg-secondary);border-radius:6px;overflow:hidden;flex-shrink:0}
        .related-thumb img{width:100%;height:100%;object-fit:cover}
        .related-title{font-size:13px;font-weight:500;margin-bottom:4px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
        .related-creator,.related-stats{color:var(--text-muted);font-size:11px}
        .error-state{text-align:center;padding:80px 20px}
        .error-state a{color:var(--accent-gold)}
        .loading-spinner{width:40px;height:40px;border:3px solid var(--border-color);border-top-color:var(--accent-gold);border-radius:50%;animation:spin 1s linear infinite;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}
        @keyframes spin{to{transform:translate(-50%,-50%) rotate(360deg)}}
        .modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);display:none;align-items:center;justify-content:center;z-index:2000}
        .modal-overlay.show{display:flex}
        .modal{background:var(--bg-secondary);border-radius:14px;padding:25px;max-width:420px;width:90%}
        .modal h3{margin-bottom:6px}
        .modal>p{color:var(--text-muted);margin-bottom:15px;font-size:13px}
        .report-options{display:flex;flex-direction:column;gap:8px;margin-bottom:15px}
        .report-option{display:flex;align-items:center;gap:10px;padding:10px 12px;background:var(--bg-tertiary);border-radius:6px;cursor:pointer;border:2px solid transparent;font-size:13px}
        .report-option:hover{border-color:var(--border-color)}
        .report-option.selected{border-color:var(--accent-gold);background:rgba(245,166,35,0.1)}
        .report-option input{display:none}
        .report-textarea{width:100%;padding:10px;background:var(--bg-tertiary);border:1px solid var(--border-color);border-radius:6px;color:var(--text-primary);font-size:13px;resize:none;min-height:70px;font-family:inherit;margin-bottom:15px}
        .report-textarea:focus{outline:none;border-color:var(--accent-gold)}
        .modal-actions{display:flex;gap:8px;justify-content:flex-end}
        .modal-btn{padding:10px 20px;border-radius:6px;border:none;cursor:pointer;font-weight:600;font-size:13px}
        .modal-btn.cancel{background:var(--bg-tertiary);color:var(--text-primary)}
        .modal-btn.submit{background:#DC3545;color:#fff}
        .modal-btn:disabled{opacity:0.5}
        .success-msg{background:rgba(40,167,69,0.1);border:1px solid #28A745;color:#28A745;padding:12px;border-radius:6px;text-align:center}
        @media(max-width:1100px){.main-content{flex-direction:column}.sidebar{width:100%}}
        @media(max-width:768px){.main-content{padding:65px 12px 20px}.creator-row{flex-direction:column;gap:12px;align-items:flex-start}.nav-links{display:none}.related-thumb{width:120px;height:68px}}
    </style>
</head>
<body>
    <header class="header">
        <div style="display:flex;align-items:center;gap:25px">
            <a href="index.html" class="logo">UNCAGED</a>
            <nav class="nav-links"><a href="browse.html">Browse</a><a href="dashboard.html">Dashboard</a></nav>
        </div>
        <div class="header-right">
            <div class="auth-logged-out" id="authLoggedOut"><a href="login.html" class="btn-login">Log In</a><a href="signup.html" class="btn-signup">Get Started</a></div>
            <div class="auth-logged-in" id="authLoggedIn">
                <a href="upload.html" class="upload-btn"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>Upload</a>
                <a href="notifications.html" class="notif-link"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg><span class="notif-badge" id="notifBadge" style="display:none">0</span></a>
                <button class="profile-btn" id="profileBtn">V<div class="dropdown" id="profileDropdown"><a href="dashboard.html">Dashboard</a><a href="my-videos.html">My Videos</a><a href="earnings.html">Earnings</a><div class="divider"></div><a href="notifications.html">Notifications</a><a href="settings.html">Settings</a><div class="divider"></div><a href="#" id="logoutBtn">Log Out</a></div></button>
            </div>
        </div>
    </header>
    <main class="main-content" id="mainContent">
        <div class="video-section">
            <div class="video-container" id="videoContainer"><div class="loading-spinner"></div></div>
            <h1 class="video-title" id="videoTitle">Loading...</h1>
            <div class="video-meta"><span id="viewCount">0 views</span> • <span id="uploadDate"></span></div>
            <div class="creator-row">
                <div class="creator-info">
                    <div class="creator-avatar" id="creatorAvatar" onclick="goToCreator()">?</div>
                    <div><div class="creator-name"><a href="#" id="creatorLink">Loading...</a></div><div class="creator-subs" id="creatorSubs">0 subscribers</div></div>
                </div>
                <button class="subscribe-btn" id="subscribeBtn">Subscribe</button>
            </div>
            <div class="action-buttons">
                <button class="action-btn" id="likeBtn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/></svg><span id="likeCount">0</span></button>
                <button class="action-btn" id="shareBtn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>Share</button>
                <button class="action-btn report" id="reportBtn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>Report</button>
            </div>
            <div class="description-box"><div class="description-text" id="descriptionText">No description</div></div>
            <div class="comments-section">
                <h3><span id="commentsCount">0</span> Comments</h3>
                <div class="comment-form" id="commentForm" style="display:none">
                    <div class="avatar" id="commentAvatar">?</div>
                    <div class="comment-input-wrap">
                        <textarea class="comment-input" id="commentInput" placeholder="Add a comment..." rows="1"></textarea>
                        <div class="comment-actions" id="commentActions" style="display:none"><button class="cancel" onclick="cancelComment()">Cancel</button><button class="submit" id="submitComment" disabled>Comment</button></div>
                    </div>
                </div>
                <div class="comments-list" id="commentsList"><p style="color:var(--text-muted);font-size:13px">Loading...</p></div>
            </div>
        </div>
        <aside class="sidebar"><h3 class="sidebar-title">Related Videos</h3><div id="relatedVideos"><p style="color:var(--text-muted);font-size:13px">Loading...</p></div></aside>
    </main>
    <div class="modal-overlay" id="reportModal">
        <div class="modal" id="modalContent">
            <h3>Report Video</h3>
            <p>Help us understand what's wrong</p>
            <div class="report-options">
                <label class="report-option"><input type="radio" name="reportType" value="inappropriate"><span>Inappropriate content</span></label>
                <label class="report-option"><input type="radio" name="reportType" value="spam"><span>Spam or misleading</span></label>
                <label class="report-option"><input type="radio" name="reportType" value="copyright"><span>Copyright violation</span></label>
                <label class="report-option"><input type="radio" name="reportType" value="harassment"><span>Harassment</span></label>
                <label class="report-option"><input type="radio" name="reportType" value="other"><span>Other</span></label>
            </div>
            <textarea class="report-textarea" id="reportReason" placeholder="Additional details (optional)..."></textarea>
            <div class="modal-actions"><button class="modal-btn cancel" onclick="closeReportModal()">Cancel</button><button class="modal-btn submit" id="submitReport" disabled>Submit</button></div>
        </div>
    </div>
    <script type="module">
        import{initializeApp}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import{getAuth,onAuthStateChanged,signOut}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import{getFirestore,doc,getDoc,updateDoc,increment,collection,query,where,getDocs,limit,addDoc,serverTimestamp,orderBy}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        const app=initializeApp({apiKey:"AIzaSyDNPN3jptNzbR8vWy5hnVCuLoIBK2AW_HQ",authDomain:"uncaged-85b49.firebaseapp.com",projectId:"uncaged-85b49",storageBucket:"uncaged-85b49.firebasestorage.app",messagingSenderId:"957750920887",appId:"1:957750920887:web:9af4d847dad76c876d2f32"});
        const auth=getAuth(app),db=getFirestore(app),videoId=new URLSearchParams(location.search).get('v');
        let currentUser=null,videoData=null,hasLiked=false,hasSubscribed=false;
        function fmt(n){if(n>=1e6)return(n/1e6).toFixed(1)+'M';if(n>=1e3)return(n/1e3).toFixed(1)+'K';return n.toString()}
        function fmtDate(ts){if(!ts)return'';const d=ts.toDate?ts.toDate():new Date(ts);return d.toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'})}
        function timeAgo(ts){if(!ts)return'';const d=ts.toDate?ts.toDate():new Date(ts);const mins=Math.floor((new Date()-d)/60000);if(mins<1)return'Just now';if(mins<60)return mins+'m';if(mins<1440)return Math.floor(mins/60)+'h';return Math.floor(mins/1440)+'d'}
        async function notify(userId,type,text,vid=null){if(!userId||userId===currentUser?.uid)return;try{await addDoc(collection(db,'notifications'),{userId,type,text,videoId:vid,read:false,createdAt:serverTimestamp()})}catch(e){}}
        onAuthStateChanged(auth,async u=>{currentUser=u;if(u){document.getElementById('authLoggedOut').style.display='none';document.getElementById('authLoggedIn').style.display='flex';document.getElementById('profileBtn').childNodes[0].textContent=(u.displayName||u.email)[0].toUpperCase();document.getElementById('commentForm').style.display='flex';document.getElementById('commentAvatar').textContent=(u.displayName||u.email)[0].toUpperCase();try{const ns=await getDocs(query(collection(db,'notifications'),where('userId','==',u.uid),where('read','==',false)));if(ns.size>0){document.getElementById('notifBadge').textContent=ns.size;document.getElementById('notifBadge').style.display='block'}}catch(e){}}else{document.getElementById('authLoggedOut').style.display='flex';document.getElementById('authLoggedIn').style.display='none'}});
        document.getElementById('profileBtn').onclick=e=>{e.stopPropagation();document.getElementById('profileDropdown').classList.toggle('show')};
        document.onclick=()=>document.getElementById('profileDropdown').classList.remove('show');
        document.querySelectorAll('.dropdown').forEach(d=>d.onclick=e=>e.stopPropagation());
        document.getElementById('logoutBtn').onclick=async e=>{e.preventDefault();await signOut(auth);location.href='index.html'};
        async function loadVideo(){if(!videoId){showError('No video');return}try{let vDoc=await getDoc(doc(db,'videos',videoId));if(!vDoc.exists()){const q=query(collection(db,'videos'),where('bunnyVideoId','==',videoId));const s=await getDocs(q);if(s.empty){showError('Not found');return}vDoc=s.docs[0]}videoData={id:vDoc.id,...vDoc.data()};await updateDoc(doc(db,'videos',videoData.id),{views:increment(1)});renderVideo();loadComments();loadRelated()}catch(e){showError(e.message)}}
        function showError(m){document.getElementById('mainContent').innerHTML='<div class="error-state"><h2>Video not found</h2><p>'+m+'</p><a href="browse.html">← Back</a></div>'}
        function renderVideo(){const bid=videoData.bunnyVideoId||videoData.id;document.getElementById('videoContainer').innerHTML='<iframe src="https://iframe.mediadelivery.net/embed/588548/'+bid+'?autoplay=true" allow="autoplay;encrypted-media;picture-in-picture" allowfullscreen></iframe>';document.getElementById('videoTitle').textContent=videoData.title||'Untitled';document.getElementById('viewCount').textContent=fmt((videoData.views||0)+1)+' views';document.getElementById('uploadDate').textContent=fmtDate(videoData.createdAt);document.getElementById('descriptionText').textContent=videoData.description||'No description';document.getElementById('likeCount').textContent=fmt(videoData.likes||0);document.title=(videoData.title||'Watch')+' | UNCAGED';const name=videoData.creatorName||'Creator';document.getElementById('creatorAvatar').textContent=name[0].toUpperCase();document.getElementById('creatorLink').textContent=name;document.getElementById('creatorLink').href='creator.html?id='+videoData.creatorId}
        window.goToCreator=()=>{if(videoData?.creatorId)location.href='creator.html?id='+videoData.creatorId};
        document.getElementById('likeBtn').onclick=async()=>{if(!currentUser){location.href='login.html';return}if(hasLiked)return;hasLiked=true;await updateDoc(doc(db,'videos',videoData.id),{likes:increment(1)});document.getElementById('likeBtn').classList.add('active');document.getElementById('likeCount').textContent=fmt((videoData.likes||0)+1);await notify(videoData.creatorId,'like','<strong>'+(currentUser.displayName||'Someone')+'</strong> liked your video "'+videoData.title+'"',videoData.id)};
        document.getElementById('subscribeBtn').onclick=async()=>{if(!currentUser){location.href='login.html';return}if(hasSubscribed)return;hasSubscribed=true;const btn=document.getElementById('subscribeBtn');btn.classList.add('subscribed');btn.textContent='Subscribed';await updateDoc(doc(db,'users',videoData.creatorId),{subscribers:increment(1)});await notify(videoData.creatorId,'subscriber','<strong>'+(currentUser.displayName||'Someone')+'</strong> subscribed to your channel')};
        document.getElementById('shareBtn').onclick=()=>{if(navigator.share)navigator.share({title:videoData.title,url:location.href});else{navigator.clipboard.writeText(location.href);alert('Link copied!')}};
        async function loadComments(){try{const s=await getDocs(query(collection(db,'comments'),where('videoId','==',videoData.id),orderBy('createdAt','desc'),limit(50)));let c=[];s.forEach(d=>c.push({id:d.id,...d.data()}));document.getElementById('commentsCount').textContent=c.length;if(!c.length){document.getElementById('commentsList').innerHTML='<p style="color:var(--text-muted);font-size:13px">No comments yet</p>';return}document.getElementById('commentsList').innerHTML=c.map(x=>'<div class="comment"><div class="avatar">'+(x.authorName||'A')[0].toUpperCase()+'</div><div class="comment-content"><div class="comment-author">'+(x.authorName||'Anon')+' <span>'+timeAgo(x.createdAt)+'</span></div><div class="comment-text">'+x.text+'</div></div></div>').join('')}catch(e){document.getElementById('commentsList').innerHTML='<p style="color:var(--text-muted);font-size:13px">Comments unavailable</p>'}}
        const ci=document.getElementById('commentInput'),ca=document.getElementById('commentActions'),sc=document.getElementById('submitComment');
        ci.onfocus=()=>ca.style.display='flex';ci.oninput=()=>sc.disabled=!ci.value.trim();
        window.cancelComment=()=>{ci.value='';ca.style.display='none';sc.disabled=true};
        sc.onclick=async()=>{if(!currentUser||!ci.value.trim())return;const txt=ci.value.trim();sc.disabled=true;sc.textContent='...';try{await addDoc(collection(db,'comments'),{videoId:videoData.id,authorId:currentUser.uid,authorName:currentUser.displayName||currentUser.email.split('@')[0],text:txt,createdAt:serverTimestamp()});await notify(videoData.creatorId,'comment','<strong>'+(currentUser.displayName||'Someone')+'</strong> commented: "'+txt.substring(0,40)+(txt.length>40?'...':'')+'"',videoData.id);cancelComment();loadComments()}catch(e){alert('Error')}sc.textContent='Comment'};
        async function loadRelated(){try{const s=await getDocs(query(collection(db,'videos'),where('visibility','==','public'),limit(8)));let h='';s.forEach(d=>{if(d.id===videoData.id)return;const v=d.data(),th=v.thumbnail||'https://vz-fa698983-d99.b-cdn.net/'+(v.bunnyVideoId||d.id)+'/thumbnail.jpg';h+='<div class="related-video" onclick="location.href=\'watch.html?v='+d.id+'\'"><div class="related-thumb"><img src="'+th+'" onerror="this.style.display=\'none\'"></div><div class="related-info"><div class="related-title">'+(v.title||'Untitled')+'</div><div class="related-creator">'+(v.creatorName||'Creator')+'</div><div class="related-stats">'+fmt(v.views||0)+' views</div></div></div>'});document.getElementById('relatedVideos').innerHTML=h||'<p style="color:var(--text-muted);font-size:13px">No videos</p>'}catch(e){}}
        document.getElementById('reportBtn').onclick=()=>{if(!currentUser){location.href='login.html';return}document.getElementById('reportModal').classList.add('show')};
        window.closeReportModal=()=>{document.getElementById('reportModal').classList.remove('show');document.querySelectorAll('.report-option').forEach(o=>o.classList.remove('selected'));document.querySelectorAll('input[name="reportType"]').forEach(r=>r.checked=false);document.getElementById('reportReason').value='';document.getElementById('submitReport').disabled=true};
        document.querySelectorAll('.report-option').forEach(o=>{o.onclick=()=>{document.querySelectorAll('.report-option').forEach(x=>x.classList.remove('selected'));o.classList.add('selected');o.querySelector('input').checked=true;document.getElementById('submitReport').disabled=false}});
        document.getElementById('submitReport').onclick=async()=>{const t=document.querySelector('input[name="reportType"]:checked')?.value;if(!t||!currentUser)return;const btn=document.getElementById('submitReport');btn.disabled=true;btn.textContent='...';try{await addDoc(collection(db,'reports'),{videoId:videoData.id,videoTitle:videoData.title,creatorId:videoData.creatorId,type:t,reason:document.getElementById('reportReason').value,reporterId:currentUser.uid,reporterName:currentUser.displayName||currentUser.email,status:'pending',createdAt:serverTimestamp()});document.getElementById('modalContent').innerHTML='<div class="success-msg"><strong>Report Submitted</strong><br>Thanks for helping keep UNCAGED safe.</div><div class="modal-actions" style="margin-top:15px"><button class="modal-btn cancel" onclick="closeReportModal()">Close</button></div>'}catch(e){alert('Error');btn.disabled=false;btn.textContent='Submit'}};
        loadVideo();
    </script>
</body>
</html>
